<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <script src="https://unpkg.com/vue@3.0.0/dist/vue.global.js"></script>
    <link rel="stylesheet" href="style/homeStyle.css">
</head>
<body>
    <div id="app">
        <div class="botones">
            <button @click="estado=0"> Peliculas </button>
            <button @click="estado=1"> Series </button>
        </div>

        <div v-if="estado==0">
            <h1>Tendencias</h1>
            <div class="movies">
                <div class="movie" v-for="movie in movies" :key="movie.id">
                    <a href="">
                        <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title">
                    </a>
                    <h4>{{ movie.title }}</h4>
                </div>
            </div>
            <h1>Mas populares</h1>
            <div class="movies">
                <div class="movie" v-for="movie in moviesPopulares" :key="movie.id">
                    <a href="">
                        <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title">
                    </a>
                    <h4>{{ movie.title }}</h4>
                </div>
            </div>
            <h1> Mejor valoradas </h1>
            <div class="movies">
                <div class="movie" v-for="movie in moviesMejorPunt" :key="movie.id">
                    <a href="">
                        <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title">
                    </a>
                    <h4>{{ movie.title }}</h4>
                </div>
            </div>

            <h1> Proximas </h1>
            <div class="movies">
                <div class="movie" v-for="movie in moviesProxima" :key="movie.id">
                    <a href="">
                        <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title">
                    </a>
                    <h4>{{ movie.title }}</h4>
                </div>
            </div>
        </div>
        <div v-if="estado==1">
                <h1>Tendencias</h1>
                <div class="movies">
                    <div class="movie" v-for="movie in serie" :key="movie.id">
                        <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title" @click="irSerie(movie)">
                        <h4>{{ movie.name }}</h4>
                    </div>
                </div>

                <h1>Populares</h1>
                <div class="movies">
                    <div class="movie" v-for="movie in seriesPopular" :key="movie.id">
                        <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title" @click="irSerie(movie)">
                        <h4>{{ movie.name }}</h4>
                    </div>
                </div>

                <h1>Al Aire Hoy</h1>
                <div class="movies">
                    <div class="movie" v-for="movie in seriesAireHoy" :key="movie.id">
                        <a :href="'DetailSerie.html?id=' + movie.id">
                            <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title">
                        </a>
                        <h4>{{ movie.name }}</h4>
                    </div>
                </div>

                <h1>Al Aire Ahora</h1>
                <div class="movies">
                    <div class="movie" v-for="movie in seriesAire" :key="movie.id">
                        <a :href="'DetailSerie.html?id=' + movie.id">
                            <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title">
                        </a>
                        <h4>{{ movie.name }}</h4>
                    </div>
                </div>

                <h1>Mejor Valoradas</h1>
                <div class="movies">
                    <div class="movie" v-for="movie in seriesMejorRaqueda" :key="movie.id">
                        <a :href="'DetailSerie.html?id=' + movie.id">
                            <img :src="'https://image.tmdb.org/t/p/w500' + movie.poster_path" :alt="movie.title">
                        </a>
                        <h4>{{ movie.name }}</h4>
                    </div>
                </div>
        </div>

    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;
        createApp({
            setup() {
                const movies = ref([]);
                const moviesPopulares = ref([]);
                const moviesMejorPunt = ref([]);
                const moviesProxima = ref ([]);

                const serie = ref([]);
                const seriesAireHoy = ref ([]);
                const seriesAire = ref ([]);
                const seriesPopular = ref ([]);
                const seriesMejorRaqueda = ref ([]);


                const estado = ref(0);

                onMounted(() => {
                    checkSession();
                    fetchMovies();
                    fetchMoviesPopulares();
                    fetchMoviesMejorPunt();
                    fetchMoviesProximas();
                    fetchSerie();
                    fetchSerieAireHoy();
                    fetchSerieAire();
                    fetchSeriePopular();
                    fetchSerieRaqued();
                });

                const checkSession = () => {
                    const session = sessionStorage.getItem('Usuario');
                    if (!session) {
                        window.location.href = 'login.html';
                    }
                };

                const fetchMovies = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/trending/movie/day", requestOptions);
                        const data = await response.json();
                        movies.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const fetchMoviesPopulares = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/movie/popular?language=es-ES&page=1", requestOptions);
                        const data = await response.json();
                        moviesPopulares.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const fetchMoviesMejorPunt = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/movie/top_rated", requestOptions);
                        const data = await response.json();
                        moviesMejorPunt.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const fetchMoviesProximas = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/movie/upcoming", requestOptions);
                        const data = await response.json();
                        moviesProxima.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const fetchSerie = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/trending/tv/day", requestOptions);
                        const data = await response.json();
                        serie.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const fetchSerieAireHoy = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/tv/airing_today", requestOptions);
                        const data = await response.json();
                        seriesAireHoy.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const fetchSerieAire = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/tv/on_the_air", requestOptions);
                        const data = await response.json();
                        seriesAire.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const fetchSeriePopular = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/tv/popular", requestOptions);
                        const data = await response.json();
                        seriesPopular.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const fetchSerieRaqued = async () => {
                    try {
                        const myHeaders = new Headers();
                        myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTU2OTBkZjg3ZGQ4YjQ1ZmQ0OGM2MjEzNzgzMjAxMiIsIm5iZiI6MTcyNzI1ODY2NS4yNzgyOTksInN1YiI6IjY2ZjJmNmRjMDIyMDhjNjdjODhkOWJjOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.RYJ10-56maf3WKvBtfBuKdNw3adiiScbvIbt_7lNx7c");

                        const requestOptions = {
                            method: 'GET',
                            headers: myHeaders,
                            redirect: 'follow'
                        };

                        const response = await fetch("https://api.themoviedb.org/3/tv/top_rated", requestOptions);
                        const data = await response.json();
                        seriesMejorRaqueda.value = data.results.map(movie => ({
                            ...movie,
                            userRating: null
                        }));
                    } catch (error) {
                        console.error(error.message);
                    }
                };

                const irSerie = (movie) =>{
                    console.log("me gusta la mama del pedro");
                    window.location.href = `DetailSerie/DetailSerie.html?id=${movie.id}`;
                }

                return {
                    movies,
                    moviesPopulares,
                    moviesMejorPunt,
                    moviesProxima,
                    serie,
                    seriesAireHoy,
                    seriesAire,
                    seriesPopular,
                    seriesMejorRaqueda,
                    estado,
                    irSerie
                };
            },

        }).mount('#app');
    </script>
</body>
</html>
